@using SBS_Ecommerce.Framework.Utilities;
@{ 
    var themes = (List<SBS_Ecommerce.Models.Theme>)ViewBag.Themes;
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="~/amaretti/light/assets/img/favicon.ico">
    <title>@ViewBag.Title</title>

    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    @{String appPath = Request.ApplicationPath;
        var domain = "";
        if (appPath != "/")
        {
            domain = appPath;
        }
    }

    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/bootstrap")

    @HtmlUtil.InitCSS(domain);
    <script src="~/Content/Admin/js/app-validation.js"></script>

</head>
<body>
    <div class="am-wrapper am-fixed-sidebar">
        <div class="am-left-sidebar">
            <div class="content">
                <div class="brand-fixed">
                    <a class="brand brand-online" href="@Url.Content("~/Master/ThemeManager")" title="">
                        <div class="logo" style="text-align: center">
                            <i class="icon s7-home" style="font-size:60px;"></i>
                        </div>
                    </a>
                </div>
                <div class="am-logo"></div>
                <ul class="sidebar-elements">                    
                    <li class="parent">
                        <a href="@Url.Action("ThemeManager","Master")"><i class="icon s7-upload"></i><span>Upload Theme</span></a>
                    </li>
                    <li class="parent">
                        <a href="@Url.Action("Logout", "Master")" s style="color: #ED1616;" showprogress>
                            <i class="icon s7-power"></i>
                            <span>
                                Logout
                            </span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="am-content">            
            <div id="uploadModal" class="modal fade" role="dialog">
                <div class="modal-dialog" style="left: auto;">
                    <!-- Modal content-->
                    <div class="modal-content">
                        <div class="modal-header-main">
                            <button type="button" data-dismiss="modal" aria-hidden="true" class="close md-close"><i class="icon s7-close-circle"></i></button>
                            <h3 class="modal-title">Upload Theme</h3>
                        </div>
                        <div class="modal-body">
                            <div>
                                @using (Html.BeginForm())
                                {
                                    @Html.AntiForgeryToken();
                                    <input type="file" id="fileInput" accept=".zip">
                                    <textarea id="txtDescription" name="description" style="width:100%;margin-top:10px;height:200px;"></textarea>
                                    <div class="confirm-upload">
                                        <input type="button" value="Cancel" class="btn btn-default" data-dismiss="modal" style="margin-top:10px" />
                                        <input id="upload-btn" class="btn btn-success btn-ok" value="Install" type="button" style="margin-top:10px">
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="main-content" style="padding-top:0px">
                <div id="alert-msg" class="container-fluid padded" hidden>
                    <div class="row-fluid">
                        <div class="span12">
                            <div class="alert alert-danger">
                                <button type="button" data-dismiss="alert" aria-label="Close" class="close"><span aria-hidden="true" class="s7-close"></span></button><span id="alert-msg-text">Error</span>
                                <br />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row2">
                    <div class="col-md-12">
                        <div class="panel">
                            <div class="panel-body">
                                <div class="row2">
                                    <div class="col-md-12 text-right">
                                        <div style="height:32px;"></div>
                                        <div onclick="$('#uploadModal').modal('show')" class="glyphicon glyphicon-upload"></div>
                                        <div>Upload Theme</div>
                                    </div>
                                </div>
                                <div class="row2">
                                    <div class="container-fluid">
                                        <div class="col-sm-12">
                                            <div>
                                                @{
                                                    int countRows = themes.Count / 4;
                                                    int pois = 0;
                                                }
                                                @for (int i = 0; i <= countRows; i++)
                                                {
                                                    <div class="row block-item-theme">
                                                        @for (int j = 0; j < 3; j++)
                                                        {
                                                            if (pois < themes.Count)
                                                            {
                                                                <div class="col-lg-4">
                                                                    @if (!themes[pois].Active)
                                                                    {
                                                                        <img src="@( Url.Content(themes[pois].Thumb))" alt="Avatar" class="image-theme" style="width:100%">
                                                                    }
                                                                    else
                                                                    {
                                                                        <img src="@( Url.Content(themes[pois].Thumb))" alt="Avatar" class="image-theme" style="width:100%;border:solid 3px #ec4444">
                                                                    }
                                                                    <div class="opera-theme">
                                                                        @if (!themes[pois].Active)
                                                                        {
                                                                            <i onclick="ChangeActive('@themes[pois].ID')" class="glyphicon glyphicon-ok-sign"></i>
                                                                        }
                                                                        else
                                                                        {
                                                                            <i class="glyphicon glyphicon-ok-sign" style="opacity:0.4;cursor:not-allowed;"></i>
                                                                        }
                                                                        <i onclick="PresentTheme('@( Url.Content(themes[pois].Thumb))','@themes[pois].ID')" class="glyphicon glyphicon-eye-open"></i>
                                                                    </div>
                                                                    <div class="theme-name">@themes[pois].Name</div>
                                                                </div>
                                                                pois++;
                                                            }
                                                        }
                                                    </div>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    @HtmlUtil.InitJS(domain);

    <script type="text/javascript" charset="utf-8">
        function UrlContent(path) {
            return '@Url.Content("~/")' + path.replace(/^\//, '');
        }
        $(document).ready(function () {
            App.init();

            $('#upload-btn').click(function (e) {
                e.preventDefault();
                $('#uploadModal').modal('hide');
                var data = new FormData($('form').get(0));

                var fileInput = document.getElementById('fileInput');
                if (fileInput.files.length > 0) {
                    if (fileInput.files[0].name.substr(fileInput.files[0].name.lastIndexOf('.')) == '.zip') {
                        if (fileInput.files[0].size > 20971520) {
                            showError('File must be smaller than 20MB');
                            return false;
                        } else {
                            for (i = 0; i < fileInput.files.length; i++) {
                                data.append('file', fileInput.files[i]);
                            }
                            $.ajax({
                                type: 'POST',
                                url: '@Url.Action("Upload", "Master")',
                                contentType: false,
                                processData: false,
                                data: data,
                                success: function (rs) {
                                    if (rs) {
                                        if (rs.Status == 0) {
                                            showAlertMessage(rs.Message, rs.Status);
                                        } else {
                                            showAlertMessage(rs.Message);
                                        }
                                    } else {
                                        showAlertMessage('An error occurred on the system. Please try again later.');
                                    }
                                },
                                error: function (rs) {
                                    console.log(rs);
                                }
                            });
                        }
                    }
                    else {
                        showAlertMessage('Invalid Format');
                        return false;
                    }
                }
                else {
                    showAlertMessage('No file selected.');
                    return false;
                }
                return false;
            });
        });

        function showAlertMessage(msg, type) {
            if (type == 0) {
                $('#alert-msg').find('.alert').addClass('alert-success');
                $('#alert-msg').find('.alert').removeClass('alert-danger');
            }
            
            $('#alert-msg-text').text(msg);
            $('#alert-msg').attr('hidden', false);
            setTimeout(function () {
                if (type == 0) {
                    window.location.reload();
                }
                $('#alert-msg').attr('hidden', true);
            }, 3000);
        }
    </script>
</body>
</html>